# Keenetic Policy Changer

Инструмент для управления политиками доступа на Keenetic роутере через SSH.

## Описание

Этот Node.js скрипт позволяет подключаться к Keenetic роутеру по SSH и управлять политиками доступа для подключенных устройств. Вы можете просматривать список устройств, список доступных политик и переключать устройства между политиками.

## Требования

- Node.js (версия 14 или выше)
- Yarn
- Keenetic роутер с включенным SSH доступом
- Учетная запись администратора роутера

1. Установите зависимости:
```bash
yarn install
```

2. Создайте файл `.env` на основе `.env.example`:
```bash
cp .env.example .env
```

3. Отредактируйте файл `.env` и укажите данные для подключения к роутеру:
```env
ROUTER_HOST=192.168.1.1
ROUTER_PORT=22
ROUTER_USERNAME=admin
ROUTER_PASSWORD=your_password
```

## Использование

### Доступные команды

#### 1. Просмотр списка устройств
```bash
yarn list-devices
```

Показывает все подключенные устройства с их MAC-адресами и IP.

#### 2. Просмотр списка политик
```bash
yarn list-policies
```

Показывает все доступные политики доступа на роутере.

#### 3. Изменение политики устройства
```bash
yarn change-policy -m *MAC* -p *POLICY*
```

Параметры:
- `-m, --mac <mac>` - MAC-адрес устройства
- `-p, --policy <policy>` - ID политики доступа

#### 4. Сброс политики устройства
```bash
yarn reset-policy -m *MAC*
```

Параметры:
- `-m, --mac <mac>` - MAC-адрес устройства

Сброс политики выбранного устройства

### Примеры использования

```bash
# Просмотреть все устройства
yarn list-devices

# Просмотреть все политики
yarn list-policies

# Переместить устройство в политику "GuestOnly"
yarn change-policy -m 00:11:22:33:44:55 -p GuestOnly

# Переместить устройство в политику по-умолчанию
yarn  reset-policy -m 00:11:22:33:44:55
```

## Структура проекта

```
keenetic-policy-changer/
├── src/
│   ├── index.js           # Главный CLI файл
│   ├── ssh-client.js      # SSH клиент для подключения к роутеру
│   └── keenetic-manager.js # Менеджер для работы с политиками
├── .env.example           # Пример конфигурации
├── .gitignore
├── package.json
└── README.md
```

## Как это работает

1. Скрипт подключается к роутеру по SSH используя библиотеку `ssh2`
2. Выполняет команды для получения информации об устройствах и политиках
3. Парсит вывод команд и представляет данные в удобном виде
4. Позволяет изменять политики устройств через команды

## Настройка SSH на Keenetic

Для работы скрипта необходимо включить SSH на роутере:

1. Зайдите в веб-интерфейс роутера
2. Перейдите в раздел "Управление" → "Общие настройки"
3. Включите компонент "SSH-сервер"
4. Настройте порт
5. Сохраните настройки

## Безопасность

- Рассмотрите использование SSH-ключей вместо паролей

## Устранение неполадок

### Ошибка подключения
- Проверьте, что SSH включен на роутере
- Убедитесь, что указан правильный IP адрес роутера
- Проверьте правильность логина и пароля

### Команды не работают
- Убедитесь, что ваш роутер поддерживает команды
- Проверьте версию прошивки роутера
