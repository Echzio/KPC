# Keenetic Policy Changer

Инструмент для управления политиками доступа на Keenetic роутере через SSH.

## Описание

Этот инструмент позволяет подключаться к Keenetic роутеру по SSH и управлять политиками доступа для подключенных устройств. Вы можете просматривать список устройств, список доступных политик и переключать устройства между политиками.

## Требования

- Node.js (версия 18 или выше)
- Keenetic роутер с включенным SSH доступом
- Учетная запись администратора роутера

## Настройка

Создайте файл `.env` в корне проекта (или в директории, откуда запускаете команду):

```bash
cp .env.example .env
```

Отредактируйте `.env` и укажите данные для подключения к роутеру:

```env
ROUTER_HOST=192.168.1.1
ROUTER_PORT=22
ROUTER_USERNAME=admin
ROUTER_PASSWORD=your_password
```

## Использование

#### 1. Просмотр списка устройств

```bash
yarn list-devices
```

Показывает все подключенные устройства с их MAC-адресами и IP.

#### 2. Просмотр списка политик

```bash
yarn list-policies
```

Показывает все доступные политики доступа на роутере.

#### 3. Изменение политики устройства

```bash
yarn change-policy -m <MAC> -p <POLICY>
```

Параметры:

- `-m, --mac <mac>` - MAC-адрес устройства
- `-p, --policy <policy>` - ID политики доступа

#### 4. Сброс политики устройства

```bash
yarn reset-policy -m <MAC>
```

Параметры:

- `-m, --mac <mac>` - MAC-адрес устройства

Возвращает устройство в дефолтную политику.

### Примеры использования

```bash
# Просмотреть все устройства
yarn list-devices

# Просмотреть все политики
yarn list-policies

# Переместить устройство в политику "Policy1"
yarn change-policy -m a2:99:3a:00:51:a7 -p Policy1

# Вернуть устройство в дефолтную политику
yarn reset-policy -m a2:99:3a:00:51:a7
```

## Как это работает

1. Подключается к роутеру по SSH используя библиотеку `ssh2`
2. Выполняет команды `show ip hotspot` и `show ip policy` для получения информации
3. Парсит вывод команд и представляет данные в удобном виде
4. Изменяет политики через команды `ip hotspot host <mac> policy <policy>`
5. Автоматически сохраняет конфигурацию через `system configuration save`

## Настройка SSH на Keenetic

Для работы скрипта необходимо включить SSH на роутере:

1. Зайдите в веб-интерфейс роутера
2. Перейдите в раздел "Управление" → "Общие настройки"
3. Включите компонент "SSH-сервер"
4. Настройте порт
5. Сохраните настройки

## Безопасность

- Храните пароли в безопасном месте
- Рассмотрите использование SSH-ключей вместо паролей
- Используйте сильные пароли для доступа к роутеру

## Устранение неполадок

### Ошибка подключения

- Проверьте, что SSH включен на роутере
- Убедитесь, что указан правильный IP адрес роутера
- Проверьте правильность логина и пароля

### Команды не работают

- Убедитесь, что ваш роутер поддерживает команды
- Проверьте версию прошивки роутера
